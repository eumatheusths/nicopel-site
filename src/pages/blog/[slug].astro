---
// src/pages/blog/[slug].astro

// 1. LINHA OBRIGATÓRIA (Isso conserta o aviso e faz o blog funcionar)
export const prerender = true;

import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import { blogPosts } from '../../data/blogPosts';

export async function getStaticPaths() {
  if (!blogPosts || !blogPosts.length) return [];

  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

if (!post) {
  return Astro.redirect('/blog');
}

// 2. Lógica das Imagens
const images = import.meta.glob('../../assets/*.{jpeg,jpg,png,gif,webp}', { eager: true });

let postImage = null;
if (post.image) {
    const imageFilename = post.image.replace(/^\//, ''); 
    const imagePath = `../../assets/${imageFilename}`;
    postImage = images[imagePath] ? (images[imagePath] as any).default : null;
}
---

<Layout title={`${post.title} - Blog Nicopel`}>
  
  <main class="pt-24 pb-16">
    <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="text-center mb-12">
            <span class="inline-block px-3 py-1 mb-4 text-xs font-bold tracking-wider text-black uppercase bg-[#B8E900] rounded-full">
                {post.category || 'Artigo'}
            </span>
            <h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 mb-6 leading-tight">
                {post.title}
            </h1>
            <div class="flex items-center justify-center text-gray-500 text-sm">
                <span>Por Equipe Nicopel</span>
                <span class="mx-2">•</span>
                <time>{post.date}</time>
            </div>
        </div>

        <div class="relative w-full h-[300px] md:h-[500px] bg-gray-100 rounded-3xl overflow-hidden mb-12 shadow-2xl">
             {postImage ? (
                <Image 
                  src={postImage} 
                  alt={post.title} 
                  width={1200}
                  format="webp"
                  class="absolute inset-0 w-full h-full object-cover" 
                />
             ) : (
                <div class="absolute inset-0 w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
                    <span class="text-sm">Imagem não disponível</span>
                </div>
             )}

             <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
             
             <div class="absolute bottom-0 left-0 p-6 md:p-8 w-full">
                 <p class="text-white/90 text-base md:text-lg italic border-l-4 border-[#B8E900] pl-4 max-w-2xl">
                    "{post.excerpt}"
                 </p>
             </div>
        </div>

        <div class="prose prose-lg prose-gray mx-auto max-w-3xl text-gray-700 leading-relaxed">
            <Fragment set:html={post.content} />
        </div>

        <div class="mt-16 pt-8 border-t border-gray-200 text-center">
            <a href="/blog" class="inline-flex items-center text-gray-900 font-bold hover:text-[#B8E900] transition-colors">
                ← Voltar para o Blog
            </a>
        </div>
    </article>
  </main>
</Layout>